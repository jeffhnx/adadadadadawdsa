-- ESP + Aimbot Script for Roblox (Highlight enemies in red, teammates in green, and track players' heads)

local ESP = {}
local players = game:GetService("Players")
local runService = game:GetService("RunService")
local camera = game:GetService("Workspace").CurrentCamera
local userInputService = game:GetService("UserInputService")
local localPlayer = players.LocalPlayer
local holdingRightClick = false

-- Customize the ESP colors
ESP.TeamColor = Color3.new(0, 1, 0)  -- Green for teammates
ESP.EnemyColor = Color3.new(1, 0, 0) -- Red for enemies

-- Function to create ESP for a player
function CreateESP(player)
    local highlight = Instance.new("Highlight")
    highlight.Parent = player.Character
    highlight.Adornee = player.Character
    highlight.FillTransparency = 0.5
    highlight.OutlineTransparency = 0.5

    -- Team check
    if player.Team == localPlayer.Team then
        highlight.FillColor = ESP.TeamColor -- Green for teammates
    else
        highlight.FillColor = ESP.EnemyColor -- Red for enemies
    end
end

-- Function to remove ESP when player dies or leaves
function RemoveESP(player)
    if player.Character then
        for _, v in pairs(player.Character:GetChildren()) do
            if v:IsA("Highlight") then
                v:Destroy()
            end
        end
    end
end

-- Function to aim at a player's head
function AimAtHead(player)
    if player and player.Character and player.Character:FindFirstChild("Head") then
        local head = player.Character:FindFirstChild("Head")
        camera.CFrame = CFrame.new(camera.CFrame.Position, head.Position)
    end
end

-- Apply ESP to existing players
for _, player in pairs(players:GetPlayers()) do
    if player ~= localPlayer and player.Character then
        CreateESP(player)
        -- Remove ESP when player dies
        player.CharacterRemoving:Connect(function()
            RemoveESP(player)
        end)
    end
end

-- Apply ESP to newly joining players
players.PlayerAdded:Connect(function(player)
    player.CharacterAdded:Connect(function()
        CreateESP(player)
    end)
end)

-- Aimbot: Track player head when holding right mouse button
userInputService.InputBegan:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton2 then -- Right Mouse Button
        holdingRightClick = true
    end
end)

userInputService.InputEnded:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton2 then -- Right Mouse Button
        holdingRightClick = false
    end
end)

-- Main loop to aim at enemies when right-click is held
runService.RenderStepped:Connect(function()
    for _, player in pairs(players:GetPlayers()) do
        if player ~= localPlayer and player.Character and holdingRightClick then
            -- Check if the player is an enemy
            if player.Team ~= localPlayer.Team and player.Character:FindFirstChild("Head") then
                AimAtHead(player) -- Track the player's head
                break -- Aim at the first enemy found
            end
        end
    end
end)

-- Update ESP during runtime
runService.RenderStepped:Connect(function()
    for _, player in pairs(players:GetPlayers()) do
        if player ~= localPlayer and player.Character then
            CreateESP(player)
        end
    end
end)
