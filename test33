local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local Camera = workspace.CurrentCamera
local LocalPlayer = Players.LocalPlayer

-- Global variables for toggle states
_G.PlayerESP = false
_G.TeamCheck = false
_G.Aimbot = false
_G.ESPColor = Color3.new(0, 1, 0) -- Default ESP color
_G.Password = "1221" -- Password for GUI access

-- Create the main ScreenGui
local screenGui = Instance.new("ScreenGui")
screenGui.Name = "BerToxGUI"
screenGui.Parent = LocalPlayer:WaitForChild("PlayerGui")

-- Create a text box for password input
local passwordBox = Instance.new("TextBox")
passwordBox.Size = UDim2.new(0, 180, 0, 25)
passwordBox.Position = UDim2.new(0, 10, 0, 10)
passwordBox.PlaceholderText = "Enter Password"
passwordBox.Parent = screenGui

-- Function to create checkboxes
local function createCheckbox(parent, text, position, toggleVariable)
    local checkbox = Instance.new("TextButton")
    checkbox.Size = UDim2.new(0, 180, 0, 25)
    checkbox.Position = position
    checkbox.Text = text
    checkbox.TextColor3 = Color3.new(1, 1, 1)
    checkbox.BackgroundColor3 = Color3.fromRGB(60, 60, 60)
    checkbox.Font = Enum.Font.SourceSans
    checkbox.TextSize = 14
    checkbox.AutoButtonColor = false
    checkbox.Parent = parent

    -- Checkbox Toggle State
    checkbox.MouseButton1Click:Connect(function()
        _G[toggleVariable] = not _G[toggleVariable]
        checkbox.BackgroundColor3 = _G[toggleVariable] and Color3.fromRGB(0, 200, 0) or Color3.fromRGB(60, 60, 60)
    end)
end

-- Create UI
local function createUI()
    createCheckbox(screenGui, "Player ESP", UDim2.new(0, 10, 0, 40), "PlayerESP")
    createCheckbox(screenGui, "Team Check", UDim2.new(0, 10, 0, 70), "TeamCheck")
    createCheckbox(screenGui, "Aimbot", UDim2.new(0, 10, 0, 100), "Aimbot")

    -- Color button
    local colorButton = Instance.new("TextButton")
    colorButton.Size = UDim2.new(0, 180, 0, 25)
    colorButton.Position = UDim2.new(0, 10, 0, 130)
    colorButton.Text = "Change ESP Color"
    colorButton.TextColor3 = Color3.new(1, 1, 1)
    colorButton.BackgroundColor3 = Color3.fromRGB(60, 60, 60)
    colorButton.Font = Enum.Font.SourceSans
    colorButton.TextSize = 14
    colorButton.AutoButtonColor = false
    colorButton.Parent = screenGui

    -- Color selection logic
    colorButton.MouseButton1Click:Connect(function()
        _G.ESPColor = Color3.new(math.random(), math.random(), math.random()) -- Change to random color for demo
        colorButton.BackgroundColor3 = _G.ESPColor
    end)
end

createUI()

-- Function to create ESP for players
local function PlayerESP()
    for _, player in ipairs(Players:GetPlayers()) do
        if player ~= LocalPlayer and player.Character and player.Character:FindFirstChild("HumanoidRootPart") then
            if _G.TeamCheck and player.Team == LocalPlayer.Team then
                continue
            end

            -- Create ESP box
            local espBox = Instance.new("BoxHandleAdornment")
            espBox.Size = Vector3.new(2, 5, 1)
            espBox.Color3 = _G.ESPColor
            espBox.AlwaysOnTop = true
            espBox.ZIndex = 10
            espBox.Parent = player.Character.HumanoidRootPart

            -- Cleanup esp on character respawn
            player.CharacterRemoving:Connect(function()
                espBox:Destroy()
            end)
        end
    end
end

-- Function to get the closest player for aimbot
local function GetClosestPlayer()
    local closestPlayer = nil
    local closestDistance = math.huge

    for _, player in ipairs(Players:GetPlayers()) do
        if player ~= LocalPlayer and player.Character and player.Character:FindFirstChild("HumanoidRootPart") then
            if _G.TeamCheck and player.Team == LocalPlayer.Team then
                continue
            end

            local distance = (player.Character.HumanoidRootPart.Position - Camera.CFrame.Position).magnitude
            if distance < closestDistance then
                closestDistance = distance
                closestPlayer = player
            end
        end
    end

    return closestPlayer
end

-- Function for Aimbot
local function Aimbot()
    if _G.Aimbot and UserInputService:IsMouseButtonPressed(Enum.UserInputType.MouseButton2) then
        local target = GetClosestPlayer()
        if target and target.Character and target.Character:FindFirstChild("Head") then
            local targetPosition = target.Character.Head.Position
            Camera.CFrame = CFrame.new(Camera.CFrame.Position, targetPosition)
        end
    end
end

-- Main render loop
RunService.RenderStepped:Connect(function()
    if passwordBox.Text == _G.Password then
        screenGui.Enabled = true -- Show GUI if password is correct
    else
        screenGui.Enabled = false -- Hide GUI if password is incorrect
    end

    PlayerESP()
    Aimbot()
end)

-- Keybind for GUI toggle (Right Control)
UserInputService.InputBegan:Connect(function(input, gameProcessedEvent)
    if not gameProcessedEvent and input.KeyCode == Enum.KeyCode.RightControl then
        screenGui.Enabled = not screenGui.Enabled -- Toggle GUI visibility
    end
end)
